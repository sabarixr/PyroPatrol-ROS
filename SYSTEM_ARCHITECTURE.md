# System Architecture Diagram

## Complete LiDAR Navigation System Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PHYSICAL SENSORS                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚   LiDAR     â”‚              â”‚  MPU6050    â”‚                       â”‚
â”‚  â”‚  /dev/ttyUSB0â”‚             â”‚   (I2C)     â”‚                       â”‚
â”‚  â”‚   115200     â”‚              â”‚  0x68       â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚         â”‚                             â”‚                              â”‚
â”‚         â”‚ Serial                      â”‚ I2C                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                             â”‚
          â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ROS2 NODES                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  lidar_node     â”‚              â”‚  mpu6050_node    â”‚              â”‚
â”‚  â”‚                 â”‚              â”‚                  â”‚              â”‚
â”‚  â”‚  - Parse frames â”‚              â”‚  - Read accel    â”‚              â”‚
â”‚  â”‚  - 50 Hz rate   â”‚              â”‚  - Read gyro     â”‚              â”‚
â”‚  â”‚  - Filter data  â”‚              â”‚  - Calibrate     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚           â”‚                                â”‚                         â”‚
â”‚           â”‚ /scan                          â”‚ /imu/mpu6050            â”‚
â”‚           â”‚ (LaserScan)                    â”‚ (Imu)                   â”‚
â”‚           â”‚                                â”‚                         â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
â”‚           â”‚                â”‚               â”‚                         â”‚
â”‚           â–¼                â–¼               â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                         â”‚
â”‚  â”‚   lidar_odometry_node          â”‚â—„â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚  â”‚                                 â”‚                                 â”‚
â”‚  â”‚  Features:                      â”‚                                 â”‚
â”‚  â”‚  â€¢ Scan matching (ICP-like)    â”‚                                 â”‚
â”‚  â”‚  â€¢ Triangulation                â”‚                                 â”‚
â”‚  â”‚  â€¢ Reference landmarks          â”‚                                 â”‚
â”‚  â”‚  â€¢ Gyro integration            â”‚                                 â”‚
â”‚  â”‚  â€¢ LiDAR offset compensation   â”‚                                 â”‚
â”‚  â”‚    - Front: 10 cm              â”‚                                 â”‚
â”‚  â”‚    - Back: 16 cm               â”‚                                 â”‚
â”‚  â”‚    - Left: 8 cm                â”‚                                 â”‚
â”‚  â”‚    - Right: 10.5 cm            â”‚                                 â”‚
â”‚  â”‚  â€¢ Starts from (0, 0)          â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚               â”‚                                                      â”‚
â”‚               â”‚ /lidar_odom                                          â”‚
â”‚               â”‚ (Odometry)                                           â”‚
â”‚               â”‚                                                      â”‚
â”‚               â–¼                                                      â”‚
â”‚         [Navigation Stack]                                           â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚  obstacle_avoidance_node       â”‚                                 â”‚
â”‚  â”‚                                 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Detection Zones:               â”‚     /scan        â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  (LaserScan)     â”‚              â”‚
â”‚  â”‚  â”‚      Front Zone      â”‚      â”‚                  â”‚              â”‚
â”‚  â”‚  â”‚     (-45Â° to 45Â°)    â”‚      â”‚  Checks:         â”‚              â”‚
â”‚  â”‚  â”‚          â†‘           â”‚      â”‚  â€¢ Front zone    â”‚              â”‚
â”‚  â”‚  â”‚          â”‚           â”‚      â”‚  â€¢ Back zone     â”‚              â”‚
â”‚  â”‚  â”‚  Left â†â”€â”€â”¼â”€â”€â†’ Right â”‚      â”‚  â€¢ Left zone     â”‚              â”‚
â”‚  â”‚  â”‚          â”‚           â”‚      â”‚  â€¢ Right zone    â”‚              â”‚
â”‚  â”‚  â”‚          â†“           â”‚      â”‚                  â”‚              â”‚
â”‚  â”‚  â”‚      Back Zone       â”‚      â”‚  Actions:        â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â€¢ Stop forward  â”‚              â”‚
â”‚  â”‚                                 â”‚  â€¢ Stop reverse  â”‚              â”‚
â”‚  â”‚  Safety Logic:                  â”‚  â€¢ Stop turns    â”‚              â”‚
â”‚  â”‚  â€¢ 15cm safety margin          â”‚  â€¢ Emergency     â”‚              â”‚
â”‚  â”‚  â€¢ 30cm emergency stop         â”‚                  â”‚              â”‚
â”‚  â”‚  â€¢ Corner detection            â”‚                  â”‚              â”‚
â”‚  â”‚  â€¢ Dimension aware             â”‚                  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚             â”‚                     â–²                                  â”‚
â”‚             â”‚ /cmd_vel           â”‚ /cmd_vel_raw                     â”‚
â”‚             â”‚ (Safe)             â”‚ (Raw)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                    â”‚
              â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  â”‚                                   â”‚
â”‚         MOTOR CONTROL            â”‚        TELEOP/NAVIGATION          â”‚
â”‚                                  â”‚                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚    â”‚  Motors     â”‚              â”‚      â”‚  Joystick/  â”‚             â”‚
â”‚    â”‚             â”‚              â””â”€â”€â”€â”€â”€â”€â”¤  Keyboard   â”‚             â”‚
â”‚    â”‚  Left:  PWM â”‚                     â”‚             â”‚             â”‚
â”‚    â”‚  Right: PWM â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Summary

### 1. Sensor Input
- **LiDAR**: Scans environment at 50 Hz â†’ `/scan`
- **IMU**: Provides orientation & acceleration â†’ `/imu/mpu6050`

### 2. Odometry Processing
```
LiDAR Scan + IMU Data
        â†“
  Feature Extraction
        â†“
  Scan Matching (frame-to-frame motion)
        â†“
  Triangulation (landmark-based correction)
        â†“
  Gyro Integration (orientation)
        â†“
  Position Update (starting from 0,0)
        â†“
    /lidar_odom
```

### 3. Obstacle Avoidance
```
  /cmd_vel_raw (from user/navigation)
        â†“
  Zone Detection (4 corners)
        â†“
  Safety Check
   â”œâ”€ Front obstacle? â†’ Block forward
   â”œâ”€ Back obstacle?  â†’ Block reverse
   â”œâ”€ Left obstacle?  â†’ Block left turn
   â””â”€ Right obstacle? â†’ Block right turn
        â†“
  /cmd_vel (safe commands)
        â†“
    Motor Control
```

## Topic Flow Diagram

```
/scan â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â†’ lidar_odometry_node â”€â”€â†’ /lidar_odom
                â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â†’ obstacle_avoidance_node â”€â”€â†’ /cmd_vel
                                    â†‘
/imu/mpu6050 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                    â”‚
/cmd_vel_raw â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Coordinate System

```
           X (Forward)
              â†‘
              â”‚
              â”‚  LiDAR mounted here
              â”‚  (10cm forward, 1.25cm right of center)
              â”‚
Y (Left) â†â”€â”€â”€â”€â—â”€â”€â”€â”€â”€ Rover Center (0,0 at start)
              â”‚
              â”‚
              â–¼


Rover starts at global coordinates (0, 0)
As it moves, position is tracked by:
  1. Scan matching (short-term accuracy)
  2. Triangulation (long-term drift correction)
  3. IMU gyro (orientation)
```

## Obstacle Detection Zones

```
                  FRONT ZONE
                 (-45Â° to 45Â°)
                      
         â•‘                      â•‘
         â•‘    Safe: Go ahead    â•‘
         â•‘                      â•‘
    â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•
         â•‘                      â•‘
  LEFT   â•‘                      â•‘  RIGHT
  ZONE   â•‘    ğŸ¤– ROVER         â•‘  ZONE
(-135Â°   â•‘    + LiDAR          â•‘  (45Â° to
 to -45Â°)â•‘                      â•‘   135Â°)
    â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•
         â•‘                      â•‘
         â•‘   Block: Obstacle    â•‘
         â•‘                      â•‘
                      
                  BACK ZONE
               (135Â° to 225Â°)

Safety margin: 15cm around rover
Stop distance: 30cm emergency threshold
```

## Triangulation Concept

```
Landmarks in Environment:
    
    ğŸ›ï¸ Landmark 1          ğŸ›ï¸ Landmark 2
      (xâ‚, yâ‚)                (xâ‚‚, yâ‚‚)
         â•²                      â•±
          â•² dâ‚              dâ‚‚ â•±
           â•²                  â•±
            â•²                â•±
             â•²              â•±
              â•²            â•±
               â•²          â•±
                â•²        â•±
                 â•²      â•±
                  â•²    â•±
                   â•²  â•±
                    ğŸ¤–
                 Rover position
                 calculated from
                 dâ‚, dâ‚‚, dâ‚ƒ distances
                    â•±
                   â•±
                  â•± dâ‚ƒ
                 â•±
                â•±
               â•±
          ğŸ›ï¸ Landmark 3
            (xâ‚ƒ, yâ‚ƒ)

Position (x, y) solved by:
  â€¢ Measuring distances dâ‚, dâ‚‚, dâ‚ƒ from LiDAR
  â€¢ Using known landmark positions
  â€¢ Applying trilateration math
  â€¢ Averaging multiple solutions
```

## Processing Pipeline

```
Time: t
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LiDAR    â”‚â”€â”€â”€â”€â–¶â”‚ Extract  â”‚â”€â”€â”€â”€â–¶â”‚ Match to â”‚
â”‚ Scan     â”‚     â”‚ Features â”‚     â”‚ Previous â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ Estimate â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”‚ Motion   â”‚
                         â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚              â”‚
                         â”‚              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   IMU    â”‚â”€â”€â”€â”€â–¶â”‚  Sensor   â”‚â—€â”€â”€â”‚Triangu-  â”‚
â”‚Gyro+Acc  â”‚     â”‚  Fusion   â”‚   â”‚lation    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Update   â”‚
                 â”‚ Position â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Publish  â”‚
                 â”‚/lidar_odomâ”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Node Lifecycle

```
1. INITIALIZATION
   â”œâ”€ lidar_node: Open serial port
   â”œâ”€ mpu6050_node: Initialize I2C, calibrate
   â”œâ”€ lidar_odometry_node: Set position to (0,0)
   â””â”€ obstacle_avoidance_node: Load parameters

2. RUNTIME LOOP (50 Hz)
   â”œâ”€ Read LiDAR frame
   â”œâ”€ Parse and publish scan
   â”œâ”€ Extract features
   â”œâ”€ Match to previous scan
   â”œâ”€ Triangulate position
   â”œâ”€ Integrate IMU data
   â”œâ”€ Publish odometry
   â”œâ”€ Check obstacle zones
   â”œâ”€ Apply safety logic
   â””â”€ Publish safe cmd_vel

3. SHUTDOWN
   â”œâ”€ Close serial port
   â”œâ”€ Stop motors
   â””â”€ Clean exit
```

---

This architecture ensures:
âœ… Accurate position tracking from (0,0)
âœ… Drift correction via triangulation
âœ… 360Â° obstacle awareness
âœ… Safe navigation in all directions
âœ… Real-time performance (50 Hz)
